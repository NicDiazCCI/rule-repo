version: 2.1
orbs:
  node: circleci/node@7.0  # Pinned to minor version for stability
executors:
  custom-node:
    docker:
      - image: cimg/node:lts
    # TODO: Test with resource_class: small for potential 50% cost reduction

jobs:
  build-node:
    # Build node project
    executor: custom-node
    steps:
      - checkout
      - node/install-packages:
          pkg-manager: npm
      - run:
          command: npm run build
      - run:
          name: Copy build artifacts
          command: |
            mkdir -p ~/artifacts
            # TypeScript outputs to dist/ directory per tsconfig.json
            if [ -d "dist" ]; then cp -R dist ~/artifacts/; fi
      - store_artifacts:
          path: ~/artifacts
          destination: node-build
      # TODO: If adding downstream jobs that need build output, use persist_to_workspace
      # - persist_to_workspace:
      #     root: .
      #     paths:
      #       - dist
workflows:
  build:
    jobs:
      - build-node
