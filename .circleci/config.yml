version: 2.1
orbs:
  node: circleci/node@7
jobs:
  build-node:
    # Build node project
    executor:
      name: node/default
      tag: '20.18'  # Use specific Node version for consistency
    resource_class: medium  # Explicit resource class
    steps:
      - checkout
      - node/install-packages:
          pkg-manager: npm
          cache-path: ~/.npm
          override-ci-command: npm ci  # Use npm ci for faster, cleaner installs
      - run:
          name: Build project
          command: npm run build
      - run:
          name: Copy artifacts
          command: |
            mkdir -p ~/artifacts
            cp -R dist ~/artifacts 2>/dev/null || true
      - store_artifacts:
          path: ~/artifacts
          destination: node-build
workflows:
  build:
    jobs:
      - build-node
